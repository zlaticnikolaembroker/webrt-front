{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nimport { joinPaths } from './URLTools';\nexport var KEY_WILDCARD = '\\0';\nexport var MEMO_KEY_PREFIX = '\\0';\nexport function createRootMapping(matcher, rootPath) {\n  if (rootPath === void 0) {\n    rootPath = '';\n  }\n\n  return rootPath !== '' ? createMapping(rootPath, matcher) : {\n    pattern: rootPath,\n    key: '',\n    regExp: new RegExp(''),\n    matcher: matcher\n  };\n}\nexport function createMapping(pattern, matcher) {\n  var processedPattern = pattern;\n\n  if (processedPattern.length > 1 && processedPattern.substr(-1) === '/') {\n    if (process.env.NODE_ENV !== 'production') {\n      console.warn(\"The pattern \\\"\" + pattern + \"\\\" ends with the character '/', so it has been automatically removed. To avoid this warning, don't add a final \\\"/\\\" to patterns.\");\n    }\n\n    processedPattern = processedPattern.substr(0, processedPattern.length - 1);\n  }\n\n  if (processedPattern[0] !== '/') {\n    if (process.env.NODE_ENV !== 'production') {\n      console.warn(\"The pattern \\\"\" + pattern + \"\\\" does not start with the character '/', so it has been automatically added. To avoid this warning, make sure to add the leading \\\"/\\\" to all patterns.\");\n    }\n\n    processedPattern = '/' + processedPattern;\n  }\n\n  if (/\\/{2,}/.test(processedPattern)) {\n    if (process.env.NODE_ENV !== 'production') {\n      console.warn(\"The pattern \\\"\" + pattern + \" has adjacent '/' characters, which have been combined into single '/' characters. To avoid this warning, don't use adjacent '/' characters within patterns.\");\n    }\n\n    processedPattern = processedPattern.replace(/\\/{2,}/g, '/');\n  }\n\n  if (processedPattern.length === 0) {\n    throw new Error(\"You cannot use an empty string \\\"\\\" as a pattern!\");\n  }\n\n  var parts = processedPattern.split('/').slice(1);\n  var pathParams = [];\n  var keyParts = [];\n  var regExpParts = ['^'];\n\n  for (var i = 0; i < parts.length; i++) {\n    var part = parts[i];\n\n    if (part.length > 1 && part[0] === ':') {\n      pathParams.push(part.slice(1));\n      keyParts.push(KEY_WILDCARD);\n      regExpParts.push('([^/]+)');\n    } else {\n      keyParts.push(part);\n      regExpParts.push(escapeRegExp(part));\n    }\n  }\n\n  return {\n    key: keyParts.join('/'),\n    matcher: matcher,\n    pattern: processedPattern,\n    pathParamNames: pathParams.length ? pathParams : undefined,\n    regExp: processedPattern === '/' ? /^\\/$/ : new RegExp(regExpParts.join('/'))\n  };\n}\nexport function matchAgainstPathname(request, mapping) {\n  var match = mapping.regExp.exec(request.path || '/');\n\n  if (!match) {\n    return;\n  }\n\n  var matchedPathname = match[0];\n  var unmatchedPath = request.path.slice(matchedPathname.length) || '';\n\n  if (unmatchedPath.length && unmatchedPath[0] !== '/') {\n    return;\n  } // Set path params using RegExp match\n\n\n  var params = request.params;\n\n  if (mapping.pathParamNames) {\n    params = __assign({}, request.params);\n\n    for (var i = 0; i < mapping.pathParamNames.length; i++) {\n      var paramName = mapping.pathParamNames[i];\n      params[paramName] = match[i + 1];\n    }\n  }\n\n  var mountpath = joinPaths(request.mountpath, matchedPathname) || '/';\n  return __assign(__assign({}, request), {\n    params: params,\n    mountpath: mountpath,\n    path: unmatchedPath,\n    url: unmatchedPath + request.search\n  });\n} // From http://stackoverflow.com/a/5306111/106302\n// Originally from http://simonwillison.net/2006/Jan/20/escape/ (dead link)\n\nfunction escapeRegExp(value) {\n  return value.replace(/[-[\\]{}()*+?.,\\\\^$|#\\s]/g, '\\\\$&');\n}","map":{"version":3,"sources":["../../src/Mapping.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nimport { joinPaths } from './URLTools';\nexport var KEY_WILDCARD = '\\0';\nexport var MEMO_KEY_PREFIX = '\\0';\nexport function createRootMapping(matcher, rootPath) {\n    if (rootPath === void 0) { rootPath = ''; }\n    return rootPath !== ''\n        ? createMapping(rootPath, matcher)\n        : {\n            pattern: rootPath,\n            key: '',\n            regExp: new RegExp(''),\n            matcher: matcher,\n        };\n}\nexport function createMapping(pattern, matcher) {\n    var processedPattern = pattern;\n    if (processedPattern.length > 1 && processedPattern.substr(-1) === '/') {\n        if (process.env.NODE_ENV !== 'production') {\n            console.warn(\"The pattern \\\"\" + pattern + \"\\\" ends with the character '/', so it has been automatically removed. To avoid this warning, don't add a final \\\"/\\\" to patterns.\");\n        }\n        processedPattern = processedPattern.substr(0, processedPattern.length - 1);\n    }\n    if (processedPattern[0] !== '/') {\n        if (process.env.NODE_ENV !== 'production') {\n            console.warn(\"The pattern \\\"\" + pattern + \"\\\" does not start with the character '/', so it has been automatically added. To avoid this warning, make sure to add the leading \\\"/\\\" to all patterns.\");\n        }\n        processedPattern = '/' + processedPattern;\n    }\n    if (/\\/{2,}/.test(processedPattern)) {\n        if (process.env.NODE_ENV !== 'production') {\n            console.warn(\"The pattern \\\"\" + pattern + \" has adjacent '/' characters, which have been combined into single '/' characters. To avoid this warning, don't use adjacent '/' characters within patterns.\");\n        }\n        processedPattern = processedPattern.replace(/\\/{2,}/g, '/');\n    }\n    if (processedPattern.length === 0) {\n        throw new Error(\"You cannot use an empty string \\\"\\\" as a pattern!\");\n    }\n    var parts = processedPattern.split('/').slice(1);\n    var pathParams = [];\n    var keyParts = [];\n    var regExpParts = ['^'];\n    for (var i = 0; i < parts.length; i++) {\n        var part = parts[i];\n        if (part.length > 1 && part[0] === ':') {\n            pathParams.push(part.slice(1));\n            keyParts.push(KEY_WILDCARD);\n            regExpParts.push('([^/]+)');\n        }\n        else {\n            keyParts.push(part);\n            regExpParts.push(escapeRegExp(part));\n        }\n    }\n    return {\n        key: keyParts.join('/'),\n        matcher: matcher,\n        pattern: processedPattern,\n        pathParamNames: pathParams.length ? pathParams : undefined,\n        regExp: processedPattern === '/' ? /^\\/$/ : new RegExp(regExpParts.join('/')),\n    };\n}\nexport function matchAgainstPathname(request, mapping) {\n    var match = mapping.regExp.exec(request.path || '/');\n    if (!match) {\n        return;\n    }\n    var matchedPathname = match[0];\n    var unmatchedPath = request.path.slice(matchedPathname.length) || '';\n    if (unmatchedPath.length && unmatchedPath[0] !== '/') {\n        return;\n    }\n    // Set path params using RegExp match\n    var params = request.params;\n    if (mapping.pathParamNames) {\n        params = __assign({}, request.params);\n        for (var i = 0; i < mapping.pathParamNames.length; i++) {\n            var paramName = mapping.pathParamNames[i];\n            params[paramName] = match[i + 1];\n        }\n    }\n    var mountpath = joinPaths(request.mountpath, matchedPathname) || '/';\n    return __assign(__assign({}, request), { params: params,\n        mountpath: mountpath, path: unmatchedPath, url: unmatchedPath + request.search });\n}\n// From http://stackoverflow.com/a/5306111/106302\n// Originally from http://simonwillison.net/2006/Jan/20/escape/ (dead link)\nfunction escapeRegExp(value) {\n    return value.replace(/[-[\\]{}()*+?.,\\\\^$|#\\s]/g, '\\\\$&');\n}\n//# sourceMappingURL=Mapping.js.map"]},"metadata":{},"sourceType":"module"}