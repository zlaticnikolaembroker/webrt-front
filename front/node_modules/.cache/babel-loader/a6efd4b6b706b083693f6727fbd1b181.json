{"ast":null,"code":"var __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function () {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n\n        case 7:\n          op = _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n\n            _.ops.push(op);\n\n            break;\n          }\n\n          if (t[2]) _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n      }\n\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nimport { extractDefault, isPromiseLike } from '../Resolvable';\nimport { compose } from '../utils/compose';\nimport { withContext } from './withContext';\nimport { withData } from './withData';\nimport { withHead } from './withHead';\nimport { withHeaders } from './withHeaders';\nimport { withState } from './withState';\nimport { withStatus } from './withStatus';\nimport { withView } from './withView';\nimport { withTitle } from './withTitle';\nimport { createChunksMatcher } from '../createChunksMatcher';\nimport { createChunk } from '../Chunks';\nexport function route(options) {\n  if (options === void 0) {\n    options = {};\n  }\n\n  var contextGetter;\n\n  if (typeof options === 'function') {\n    contextGetter = options;\n  } else {\n    var data_1 = options.data,\n        getData_1 = options.getData,\n        error_1 = options.error,\n        head_1 = options.head,\n        getHead_1 = options.getHead,\n        headers_1 = options.headers,\n        getHeaders_1 = options.getHeaders,\n        state_1 = options.state,\n        getState_1 = options.getState,\n        status_1 = options.status,\n        getStatus_1 = options.getStatus,\n        title_1 = options.title,\n        getTitle_1 = options.getTitle,\n        view_1 = options.view,\n        getView_1 = options.getView,\n        other = __rest(options, [\"data\", \"getData\", \"error\", \"head\", \"getHead\", \"headers\", \"getHeaders\", \"state\", \"getState\", \"status\", \"getStatus\", \"title\", \"getTitle\", \"view\", \"getView\"]);\n\n    if (process.env.NODE_ENV !== 'production') {\n      var unknownKeys = Object.keys(other);\n\n      if (unknownKeys.length) {\n        console.warn(\"route() received unknown options \" + unknownKeys.map(function (x) {\n          return \"\\\"\" + x + \"\\\"\";\n        }).join(', ') + \".\");\n      }\n    }\n\n    contextGetter = function getRoute(req, context) {\n      var _a;\n\n      var _this = this;\n\n      var _b = __read(extractValue(data_1, getData_1, req, context), 2),\n          dataMaybePromise = _b[0],\n          a = _b[1];\n\n      if (!dataMaybePromise) {\n        dataMaybePromise = {};\n      } else if (isPromiseLike(dataMaybePromise)) {\n        dataMaybePromise = dataMaybePromise.then(inputOrEmptyObject);\n      }\n\n      var _c = __read(extractValue(headers_1, getHeaders_1, req, context), 2),\n          headersMaybePromise = _c[0],\n          b = _c[1];\n\n      var _d = __read(extractValue(state_1, getState_1, req, context), 2),\n          stateMaybePromise = _d[0],\n          c = _d[1];\n\n      var _e = __read(extractValue(status_1, getStatus_1, req, context), 2),\n          statusMaybePromise = _e[0],\n          d = _e[1];\n\n      var _f = __read(extractValue(title_1, getTitle_1, req, context), 2),\n          titleMaybePromise = _f[0],\n          e = _f[1];\n\n      var _g = __read(extractValue(head_1, getHead_1, req, context), 2),\n          headMaybePromise = _g[0],\n          f = _g[1];\n\n      var viewMaybePromise;\n      var g;\n\n      if (req.method !== 'HEAD') {\n        _a = __read(extractValue(view_1, getView_1, req, context), 2), viewMaybePromise = _a[0], g = _a[1];\n      } // If anything is a promise, return a promise\n\n\n      if (a || b || c || d || e || f || g) {\n        return function () {\n          return __awaiter(_this, void 0, void 0, function () {\n            var _a;\n\n            return __generator(this, function (_b) {\n              switch (_b.label) {\n                case 0:\n                  _a = {};\n                  return [4\n                  /*yield*/\n                  , dataMaybePromise];\n\n                case 1:\n                  _a.data = _b.sent(), _a.error = error_1;\n                  return [4\n                  /*yield*/\n                  , headMaybePromise];\n\n                case 2:\n                  _a.head = _b.sent();\n                  return [4\n                  /*yield*/\n                  , headersMaybePromise];\n\n                case 3:\n                  _a.headers = _b.sent();\n                  return [4\n                  /*yield*/\n                  , stateMaybePromise];\n\n                case 4:\n                  _a.state = _b.sent();\n                  return [4\n                  /*yield*/\n                  , statusMaybePromise];\n\n                case 5:\n                  _a.status = _b.sent();\n                  return [4\n                  /*yield*/\n                  , titleMaybePromise];\n\n                case 6:\n                  _a.title = _b.sent();\n                  return [4\n                  /*yield*/\n                  , viewMaybePromise];\n\n                case 7:\n                  return [2\n                  /*return*/\n                  , (_a.view = _b.sent(), _a)];\n              }\n            });\n          });\n        }();\n      } // If nothing is a promise, return a synchronous result\n      else {\n          return {\n            data: dataMaybePromise,\n            error: error_1,\n            head: headMaybePromise,\n            headers: headersMaybePromise,\n            state: stateMaybePromise,\n            status: statusMaybePromise,\n            title: titleMaybePromise,\n            view: viewMaybePromise\n          };\n        }\n    };\n  }\n\n  return compose(withContext(function (req, context) {\n    return req.crawler ? {} : contextGetter(req, context);\n  }), withData(function (req) {\n    return req.context.data;\n  }), withHead(function (req) {\n    return req.context.head;\n  }), withHeaders(function (req) {\n    return req.context.headers;\n  }), withState(function (req) {\n    return req.context.state || null;\n  }), withStatus(function (req) {\n    return req.context.status;\n  }), withTitle(function (req) {\n    return req.context.title;\n  }), withView(function (req) {\n    return req.context.view;\n  }, undefined, true), createChunksMatcher(function (req) {\n    return req.context.error;\n  }, undefined, function (error, request) {\n    return error ? [createChunk('error', request, {\n      error: error\n    })] : [];\n  }));\n}\n\nfunction inputOrEmptyObject(x) {\n  return x || {};\n}\n\nfunction extractValue(value, getter, request, context) {\n  if (getter) {\n    var valueOrPromise = getter(request, context);\n\n    if (isPromiseLike(valueOrPromise)) {\n      return [valueOrPromise.then(extractDefault), true];\n    }\n\n    return [valueOrPromise, false];\n  } else {\n    return [value, false];\n  }\n}","map":{"version":3,"sources":["../../../src/matchers/route.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nimport { extractDefault, isPromiseLike } from '../Resolvable';\nimport { compose } from '../utils/compose';\nimport { withContext } from './withContext';\nimport { withData } from './withData';\nimport { withHead } from './withHead';\nimport { withHeaders } from './withHeaders';\nimport { withState } from './withState';\nimport { withStatus } from './withStatus';\nimport { withView } from './withView';\nimport { withTitle } from './withTitle';\nimport { createChunksMatcher } from '../createChunksMatcher';\nimport { createChunk } from '../Chunks';\nexport function route(options) {\n    if (options === void 0) { options = {}; }\n    var contextGetter;\n    if (typeof options === 'function') {\n        contextGetter = options;\n    }\n    else {\n        var data_1 = options.data, getData_1 = options.getData, error_1 = options.error, head_1 = options.head, getHead_1 = options.getHead, headers_1 = options.headers, getHeaders_1 = options.getHeaders, state_1 = options.state, getState_1 = options.getState, status_1 = options.status, getStatus_1 = options.getStatus, title_1 = options.title, getTitle_1 = options.getTitle, view_1 = options.view, getView_1 = options.getView, other = __rest(options, [\"data\", \"getData\", \"error\", \"head\", \"getHead\", \"headers\", \"getHeaders\", \"state\", \"getState\", \"status\", \"getStatus\", \"title\", \"getTitle\", \"view\", \"getView\"]);\n        if (process.env.NODE_ENV !== 'production') {\n            var unknownKeys = Object.keys(other);\n            if (unknownKeys.length) {\n                console.warn(\"route() received unknown options \" + unknownKeys\n                    .map(function (x) { return \"\\\"\" + x + \"\\\"\"; })\n                    .join(', ') + \".\");\n            }\n        }\n        contextGetter = function getRoute(req, context) {\n            var _a;\n            var _this = this;\n            var _b = __read(extractValue(data_1, getData_1, req, context), 2), dataMaybePromise = _b[0], a = _b[1];\n            if (!dataMaybePromise) {\n                dataMaybePromise = {};\n            }\n            else if (isPromiseLike(dataMaybePromise)) {\n                dataMaybePromise = dataMaybePromise.then(inputOrEmptyObject);\n            }\n            var _c = __read(extractValue(headers_1, getHeaders_1, req, context), 2), headersMaybePromise = _c[0], b = _c[1];\n            var _d = __read(extractValue(state_1, getState_1, req, context), 2), stateMaybePromise = _d[0], c = _d[1];\n            var _e = __read(extractValue(status_1, getStatus_1, req, context), 2), statusMaybePromise = _e[0], d = _e[1];\n            var _f = __read(extractValue(title_1, getTitle_1, req, context), 2), titleMaybePromise = _f[0], e = _f[1];\n            var _g = __read(extractValue(head_1, getHead_1, req, context), 2), headMaybePromise = _g[0], f = _g[1];\n            var viewMaybePromise;\n            var g;\n            if (req.method !== 'HEAD') {\n                _a = __read(extractValue(view_1, getView_1, req, context), 2), viewMaybePromise = _a[0], g = _a[1];\n            }\n            // If anything is a promise, return a promise\n            if (a || b || c || d || e || f || g) {\n                return (function () { return __awaiter(_this, void 0, void 0, function () {\n                    var _a;\n                    return __generator(this, function (_b) {\n                        switch (_b.label) {\n                            case 0:\n                                _a = {};\n                                return [4 /*yield*/, dataMaybePromise];\n                            case 1:\n                                _a.data = _b.sent(),\n                                    _a.error = error_1;\n                                return [4 /*yield*/, headMaybePromise];\n                            case 2:\n                                _a.head = _b.sent();\n                                return [4 /*yield*/, headersMaybePromise];\n                            case 3:\n                                _a.headers = _b.sent();\n                                return [4 /*yield*/, stateMaybePromise];\n                            case 4:\n                                _a.state = _b.sent();\n                                return [4 /*yield*/, statusMaybePromise];\n                            case 5:\n                                _a.status = _b.sent();\n                                return [4 /*yield*/, titleMaybePromise];\n                            case 6:\n                                _a.title = _b.sent();\n                                return [4 /*yield*/, viewMaybePromise];\n                            case 7: return [2 /*return*/, (_a.view = _b.sent(),\n                                    _a)];\n                        }\n                    });\n                }); })();\n            }\n            // If nothing is a promise, return a synchronous result\n            else {\n                return {\n                    data: dataMaybePromise,\n                    error: error_1,\n                    head: headMaybePromise,\n                    headers: headersMaybePromise,\n                    state: stateMaybePromise,\n                    status: statusMaybePromise,\n                    title: titleMaybePromise,\n                    view: viewMaybePromise,\n                };\n            }\n        };\n    }\n    return compose(withContext(function (req, context) {\n        return req.crawler ? {} : contextGetter(req, context);\n    }), withData(function (req) { return req.context.data; }), withHead(function (req) { return req.context.head; }), withHeaders(function (req) { return req.context.headers; }), withState(function (req) { return req.context.state || null; }), withStatus(function (req) { return req.context.status; }), withTitle(function (req) { return req.context.title; }), withView(function (req) { return req.context.view; }, undefined, true), createChunksMatcher(function (req) { return req.context.error; }, undefined, function (error, request) { return (error ? [createChunk('error', request, { error: error })] : []); }));\n}\nfunction inputOrEmptyObject(x) {\n    return x || {};\n}\nfunction extractValue(value, getter, request, context) {\n    if (getter) {\n        var valueOrPromise = getter(request, context);\n        if (isPromiseLike(valueOrPromise)) {\n            return [valueOrPromise.then(extractDefault), true];\n        }\n        return [valueOrPromise, false];\n    }\n    else {\n        return [value, false];\n    }\n}\n//# sourceMappingURL=route.js.map"]},"metadata":{},"sourceType":"module"}